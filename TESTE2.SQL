SELECT VW04004.TB04010_CODIGO2 Pedido,
	   TB01008_NOME Cliente,
	   TB04010_CONTRATO	Contrato,
	   TB04010_MES Mes,
	   TB01006_CODIGO CodVendedor,
	   dbo.TB01006.TB01006_NOME Vendedor,
	   NULL TipoVendedorContrato,
	   TB02155_COMISSAO Comissao,
	   TB04010_CODIGO Num,
	   TB04010_DTVENC Vencimento,
	   TB04010_VLRTITULO ValorParcela,
	   TB04010_VLRMOV ValorPedido,
	   (SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	   dbo.TB04011.TB04011_DTCAD DataBaixa,
	   CAST(TB04010_VLRMOV * TB02155_COMISSAO / 100 as numeric(11,2)) ValorComissao,
	   'Locacao - Fechamentos Indicacoes' Tipo
  FROM VW04004
LEFT JOIN TB04011 ON TB04011_CODIGO = VW04004.TB04010_CODIGO
				 AND TB04011_CODCLI = VW04004.TB04010_CODCLI
				 AND TB04011_CODEMP = VW04004.TB04010_CODEMP
				 AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC
				 AND TB04011_DTVENC = VW04004.TB04010_DTVENC
LEFT JOIN TB02155 ON TB02155_CONTRATO = VW04004.TB04010_CONTRATO
				 AND TB02155_VEND = @Vendedor
LEFT JOIN TB01006 ON TB01006_CODIGO = @Vendedor
LEFT JOIN TB02111 ON TB02111_CODIGO = VW04004.TB04010_CONTRATO
				 AND TB02111_CODCLI = VW04004.TB04010_CODCLI
				 AND TB02111_CODEMP = VW04004.TB04010_CODEMP
 WHERE TB04011_DTCAD BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
   AND TB02155_VEND = @Vendedor
   AND TB02155_VEND <> VW04004.TB04010_VEND