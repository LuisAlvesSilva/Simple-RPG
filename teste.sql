-- PRINCIPAL --

SELECT
	TB04010_CODIGO2 Pedido,
	TB01008_NOME Cliente,
	'N/A' Contrato,
	TB04010_MES Mes,
	TB04010_VEND CodVendedor,
	TB01006_2.TB01006_NOME Vendedor,
	'N/A' TipoVendedorContrato,
	(CASE WHEN (SELECT TOP 1 TB01045_COMISSAO FROM TB01045 WHERE TB01045_CODIGOX = (SELECT TOP 1 TB02022_TABELA FROM TB02022 LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO WHERE TB02021_CODIGO = VW04004.TB04010_CODIGO2)) = 0 THEN TB01006_2.TB01006_COMISSAO ELSE (SELECT TOP 1 TB01045_COMISSAO FROM TB01045 WHERE TB01045_CODIGOX = (SELECT TOP 1 TB02022_TABELA FROM TB02022 LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO WHERE TB02021_CODIGO = VW04004.TB04010_CODIGO2)) END) Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	TB04010_VLRTITULO ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) DataBaixa,
	CAST(TB04010_VLRMOV * (CASE WHEN (SELECT TOP 1 TB01045_COMISSAO FROM TB01045 WHERE TB01045_CODIGOX = (SELECT TOP 1 TB02022_TABELA FROM TB02022 LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO WHERE TB02021_CODIGO = VW04004.TB04010_CODIGO2)) = 0 THEN TB01006_2.TB01006_COMISSAO ELSE (SELECT TOP 1 TB01045_COMISSAO FROM TB01045 WHERE TB01045_CODIGOX = (SELECT TOP 1 TB02022_TABELA FROM TB02022 LEFT JOIN TB02021 ON TB02021_CODIGO = TB02022_CODIGO WHERE TB02021_CODIGO = VW04004.TB04010_CODIGO2)) END) / 100 as numeric(11,2)) ValorComissao,
	'Vendas' AS Tipo
FROM
	VW04004
LEFT JOIN TB01006 AS TB01006_2 ON TB01006_2.TB01006_CODIGO = TB04010_VEND
WHERE
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB04010_VEND = @Vendedor
	AND
	TB04010_VLRPAGO > 0
	AND
	TB04010_CONTRATO IS NULL

UNION

SELECT
	ISNULL(TB02126_RECIBO, TB02126_CODVENDA) Pedido,
	TB01008_NOME Cliente,
	TB02155_CONTRATO Contrato,
	TB02126_MES Mes,
	TB02155_VEND CodVendedor,
	TB01006_NOME Vendedor,
	(CASE WHEN TB02155_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB02155_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) AS TipoVendedorContrato,
	TB02155_COMISSAO Comissao,
	(SELECT TOP 1 TB04010_CODIGO FROM TB04010 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) Num,
	(SELECT TOP 1 TB04010_DTVENC FROM TB04010 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) Vencimento,
	(SELECT TOP 1 (SELECT TB04011_VLRPAGO FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO AND TB04011_CODCON IS NOT NULL) FROM VW04004 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) ValorParcela,
	(SELECT TOP 1 TB04010_VLRMOV FROM TB04010 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) ValorPedido,
	TB02126_VLRRETENCOES Retencao,
	(SELECT TOP 1 (SELECT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO AND TB04011_CODCON IS NOT NULL) FROM VW04004 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) DataBaixa,
	CAST((SELECT TOP 1 TB04010_VLRMOV FROM VW04004 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) * TB02155_COMISSAO / 100 as numeric(11,2)) ValorComissao,
	'Locação - Fechamento' AS Tipo
FROM
	TB02155
LEFT JOIN TB02126 ON TB02126_CONTRATO = TB02155_CONTRATO
LEFT JOIN TB01008 ON TB01008_CODIGO = TB02126_CODCLI
LEFT JOIN TB01006 ON TB01006_CODIGO = TB02155_VEND
WHERE
	ISNULL(TB02126_RECIBO, TB02126_CODVENDA) IN (SELECT TB04010_CODIGO2 FROM TB04011 LEFT JOIN TB04010 ON TB04010_CODIGO = TB04011_CODIGO AND TB04010_CODEMP = TB04011_CODEMP AND TB04010_CODCLI = TB04011_CODCLI WHERE TB04011_DTCAD BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00')
	AND
	TB02155_VEND = @Vendedor
	AND
	(SELECT TOP 1 TB04010_VLRPAGO FROM TB04010 WHERE TB04010_CODIGO2 = ISNULL(TB02126_RECIBO, TB02126_CODVENDA) AND TB04010_CODCLI = TB02126_CODCLI) > 0
	AND
	(CASE WHEN TB02155_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB02155_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) = 'Principal'
	AND NOT EXISTS (SELECT * FROM TB04010 WHERE TB04010_VEND = '0043' AND TB04010_CODIGO2 = TB02126_RECIBO AND TB04010_CODCLI = TB02126_CODCLI AND TB04010_CONTRATO = TB02126_CONTRATO)
	AND NOT EXISTS (SELECT * FROM TB04010 WHERE TB04010_VEND = '0043' AND TB04010_CODIGO2 = TB02126_CODVENDA AND TB04010_CODCLI = TB02126_CODCLI AND TB04010_CONTRATO = TB02126_CONTRATO)

UNION

SELECT
	TB04010_CODIGO2 Pedido,
	TB01008_2.TB01008_NOME Cliente,
	TB02155_CONTRATO Contrato,
	TB04010_MES Mes,
	TB02155_VEND CodVendedor,
	TB01006_1.TB01006_NOME Vendedor,
	(CASE WHEN TB02155_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB02155_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) AS TipoVendedorContrato,
	TB02155_COMISSAO Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	VW04004.TB04010_VLRMOV ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) DataBaixa,
	CAST(VW04004.TB04010_VLRMOV * TB02155_COMISSAO / 100 as numeric(11,2)) ValorComissao,
	'Locação - Migração' AS Tipo
FROM
	TB02155
LEFT JOIN VW04004 ON VW04004.TB04010_CONTRATO = TB02155_CONTRATO AND TB04010_CONTRATO IS NOT NULL
LEFT JOIN TB01008 AS TB01008_2 ON TB01008_2.TB01008_CODIGO = TB04010_CODCLI
LEFT JOIN TB01006 AS TB01006_1 ON TB01006_1.TB01006_CODIGO = TB02155_VEND
WHERE
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB02155_VEND = @Vendedor
	AND
	TB04010_VLRPAGO > 0
	AND
	TB04010_OPCAD = 'MIGRACAO'
	AND
	(CASE WHEN TB02155_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB02155_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) = 'Principal'

UNION

SELECT
	TB04010_CODIGO2 Pedido,
	TB01008_NOME Cliente,
	'N/A' Contrato,
	TB04010_MES Mes,
	TB04010_VEND CodVendedor,
	TB01006_3.TB01006_NOME Vendedor,
	'N/A' TipoVendedorContrato,
	(SELECT TOP 1 TB01005_COMISSAO FROM TB01005 WHERE TB01005_CODIGO = TB02023_CODSERV) Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	TB04010_VLRMOV ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO) DataBaixa,
	CAST(TB04010_VLRMOV * (SELECT TOP 1 TB01005_COMISSAO FROM TB01005 WHERE TB01005_CODIGO = TB02023_CODSERV) / 100 as numeric(11,2)) ValorComissao,
	'Vendas - Serviços' AS Tipo
FROM
	VW04004
LEFT JOIN TB01006 AS TB01006_3 ON TB01006_3.TB01006_CODIGO = TB04010_VEND
LEFT JOIN TB02021 AS TB02021_1 ON TB02021_1.TB02021_CODIGO = VW04004.TB04010_CODIGO2 AND TB02021_1.TB02021_CODCLI = VW04004.TB04010_CODCLI AND TB02021_1.TB02021_CODEMP = VW04004.TB04010_CODEMP
LEFT JOIN TB02023 ON TB02023_CODIGO = TB02021_1.TB02021_CODIGO
LEFT JOIN TB04011 AS TB04011_A ON TB04011_A.TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_A.TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_A.TB04011_CODCLI = VW04004.TB04010_CODCLI
WHERE
	TB04011_A.TB04011_DTCAD BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB04010_VEND = @Vendedor
	AND
	TB04010_VLRPAGO > 0
	AND
	TB04010_CONTRATO IS NULL
	AND
	TB02021_1.TB02021_VLRSERV > 0
	AND
	TB02021_VLRBACKUP = 0

UNION

SELECT
	TB02118_CODIGO Pedido,
	TB01008_NOME Cliente,
	TB02118_CONTRATO Contrato,
	TB04010_MES Mes,
	TB02118_VEND CodVendedor,
	TB01006_NOME Vendedor,
	(CASE WHEN TB02118_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB02118_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) AS TipoVendedorContrato,
	(SELECT TB02155_COMISSAO FROM TB02155 WHERE TB02155_CONTRATO = TB02118_CONTRATO AND TB02155_VEND = TB02118_VEND) Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	VW04004.TB04010_VLRMOV ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) DataBaixa,
	CAST(VW04004.TB04010_VLRMOV * (SELECT TB02155_COMISSAO FROM TB02155 WHERE TB02155_CONTRATO = TB02118_CONTRATO AND TB02155_VEND = TB02118_VEND) / 100 as numeric(11,2)) ValorComissao,
	'Locação - Recibo Manual' AS Tipo
FROM
	TB02118

LEFT JOIN VW04004 ON TB04010_CONTRATO = TB02118_CONTRATO AND TB04010_CODIGO2 = TB02118_CODIGO AND TB04010_CODEMP = TB02118_CODEMP AND TB04010_VEND = TB02118_VEND

WHERE
	(SELECT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB02118_VEND = @Vendedor
	AND
	TB02118_CODIGO NOT IN (SELECT ISNULL(TB02126_RECIBO, TB02126_CODVENDA) FROM TB02126 WHERE TB02126_CONTRATO = TB02118_CONTRATO AND TB02126_CODCLI = TB02118_CODCLI)
	

UNION

SELECT
	TB04010_CODIGO2 Pedido,
	TB01008_NOME Cliente,
	TB04010_CONTRATO Contrato,
	TB04010_MES Mes,
	TB04010_VEND CodVendedor,
	TB01006_3.TB01006_NOME Vendedor,
	NULL TipoVendedorContrato,
   (SELECT TB02155_COMISSAO FROM TB02155 WHERE TB02155_CONTRATO = TB04010_CONTRATO AND TB02155_VEND = TB04010_VEND) Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	TB04010_VLRMOV ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT TOP 1 TB04011_DTCAD 
	   FROM TB04011
	  WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO
	    AND TB04011_CODEMP = VW04004.TB04010_CODEMP
		AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC
		AND TB04011_DTVENC = VW04004.TB04010_DTVENC
		AND TB04011_CODCLI = VW04004.TB04010_CODCLI) DataBaixa,
	CAST(TB04010_VLRMOV * (SELECT TB02155_COMISSAO FROM TB02155 WHERE TB02155_CONTRATO = TB04010_CONTRATO AND TB02155_VEND = TB04010_VEND) / 100 as numeric(11,2)) ValorComissao,
	'Locacao - Titulos avulsos' AS Tipo
FROM
	VW04004
LEFT JOIN TB01006 AS TB01006_3 ON TB01006_3.TB01006_CODIGO = TB04010_VEND
LEFT JOIN TB02111 ON TB02111_CODIGO = TB04010_CONTRATO
WHERE
	(SELECT TOP 1 TB04011_DTCAD 
	   FROM TB04011
	  WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO 
	    AND TB04011_CODEMP = VW04004.TB04010_CODEMP 
		AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC
		AND TB04011_DTVENC = VW04004.TB04010_DTVENC
		AND TB04011_CODCLI = VW04004.TB04010_CODCLI) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB04010_VEND = @Vendedor
	AND
	(CASE WHEN TB04010_VEND = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB04010_CONTRATO) THEN 'Principal' ELSE 'Indicação' END) = 'Principal'
	AND
	TB04010_VLRPAGO > 0
	AND
	TB04010_CONTRATO IS NOT NULL
	AND
	TB04010_CODIGO2 NOT IN (SELECT ISNULL(TB02126_RECIBO, TB02126_CODVENDA) FROM TB02126 WHERE TB02126_CONTRATO = VW04004.TB04010_CONTRATO)
	AND
	TB04010_OPCAD <> 'MIGRACAO'
	AND TB04010_CODIGO IN (SELECT TB04010_CODIGO
							     FROM TB02118
					        LEFT JOIN VW04004 ON TB04010_CONTRATO = TB02118_CONTRATO AND TB04010_CODIGO2 = TB02118_CODIGO AND TB04010_CODEMP = TB02118_CODEMP AND TB04010_VEND = TB02118_VEND
							    WHERE (SELECT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
								  AND TB02118_VEND = @Vendedor
								  AND TB02118_CODIGO NOT IN (SELECT ISNULL(TB02126_RECIBO, TB02126_CODVENDA) FROM TB02126 WHERE TB02126_CONTRATO = TB02118_CONTRATO AND TB02126_CODCLI = TB02118_CODCLI))

UNION

SELECT
	TB04010_CODIGO2 Pedido,
	TB01008_NOME Cliente,
	TB04010_CONTRATO Contrato,
	TB04010_MES Mes,
	TB04010_VEND CodVendedor,
	TB01006_3.TB01006_NOME Vendedor,
	'N/A' TipoVendedorContrato,
	(SELECT TOP 1 TB02155_COMISSAO FROM TB02155 WHERE TB02155_VEND = TB04010_VEND AND TB02155_CONTRATO = TB04010_CONTRATO) Comissao,
	TB04010_CODIGO Num,
	TB04010_DTVENC Vencimento,
	TB04010_VLRTITULO ValorParcela,
	TB04010_VLRMOV ValorPedido,
	(SELECT TOP 1 TB02126_VLRRETENCOES 
			FROM TB02126 
			WHERE TB02126_CONTRATO = TB04010_CONTRATO AND ISNULL(TB02126_CODVENDA, TB02126_RECIBO) = TB04010_CODIGO2)Retencao,
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO) DataBaixa,
	CAST(TB04010_VLRMOV * (SELECT TOP 1 TB02155_COMISSAO FROM TB02155 WHERE TB02155_VEND = TB04010_VEND AND TB02155_CONTRATO = TB04010_CONTRATO) / 100 as numeric(11,2)) ValorComissao,
	'Locação - Pedido Avulso Serviços' AS Tipo
FROM
	VW04004
LEFT JOIN TB01006 AS TB01006_3 ON TB01006_3.TB01006_CODIGO = TB04010_VEND
LEFT JOIN TB02021 AS TB02021_1 ON TB02021_1.TB02021_CODIGO = VW04004.TB04010_CODIGO2 AND TB02021_1.TB02021_CODCLI = VW04004.TB04010_CODCLI AND TB02021_1.TB02021_CODEMP = VW04004.TB04010_CODEMP
LEFT JOIN TB02023 ON TB02023_CODIGO = TB02021_1.TB02021_CODIGO
WHERE
	(SELECT DISTINCT TB04011_DTCAD FROM TB04011 WHERE TB04011_CODIGO = VW04004.TB04010_CODIGO AND TB04011_CODEMP = VW04004.TB04010_CODEMP AND TB04011_CODCLI = VW04004.TB04010_CODCLI AND TB04011_TIPDOC = VW04004.TB04010_TIPDOC AND TB04011_DTVENC = VW04004.TB04010_DTVENC AND TB04011_VLRPAGO = VW04004.TB04010_VLRPAGO) BETWEEN @De + ' 00:00:00' AND @Ate + ' 23:59:00'
	AND
	TB04010_VEND = @Vendedor
	AND
	TB04010_VLRPAGO > 0
	AND
	TB04010_CONTRATO IS NOT NULL
	AND
	@Vendedor = (SELECT TB02111_VEND FROM TB02111 WHERE TB02111_CODIGO = TB04010_CONTRATO)
	AND
	TB02021_1.TB02021_VLRSERV > 0
	AND
	TB02021_VLRBACKUP = 0 and TB02021_CODIGO NOT IN (SELECT TB02126_CODVENDA FROM TB02126 WHERE TB02126_CODVENDA IS NOT NULL)